$(function(){var methods;return methods={init:function(options){var def,_this;return null==options&&(options={}),def={content:{},geo:{lat:"",lon:"",city:"",region:"",country:""},result:{key:""}},$.extend(!0,def,options),$(this).data("sn",def),_this=$(this),$(this).snDemand("geoIp"),$("#demand-name").live("keyup",function(){return _this.snDemand("checkName",$(this).val())}),$("#demand-phone").live("keyup",function(){return _this.snDemand("checkPhone",$(this).val())}),$("#push-demand").live("click",function(){return $("#wall-demand").show().css({width:$(document).width(),height:$(document).height()}),$("#modal-demand").show()}),$(".modal-header a.close").live("click",function(){return $("#wall-demand").hide(),$("#modal-demand").hide()}),$("#modal-close").live("click",function(){return $("#wall-demand").hide(),$("#modal-demand").hide()}),$("#modal-send").live("click",function(){return $(this).snDemand("check")?($(".demand-success p").show(),$(".demand-error p").hide(),$("#modal-send").hide(),_this.snDemand("send")):($(".demand-success p").hide(),$(".demand-error p").show())})},send:function(){var sn;return sn=$(this).data("sn"),$(this).snDemand("addToBase"),$(this).snDemand("addToGit")},geoIp:function(){var sn,_this;return _this=$(this),sn=$(this).data("sn"),$.ajax({url:"http://j.maxmind.com/app/geoip.js",dataType:"script",timeout:5e3,success:function(){return sn.geo={lat:geoip_latitude(),lon:geoip_longitude(),city:geoip_city(),region:geoip_region(),country:geoip_country_name()},_this.data("sn",sn)}})},addToBase:function(){var sn;return sn=$(this).data("sn"),$.ajax({url:"http://www.standart-n.ru/external/ajax_claim.php",type:"GET",data:{act:"add",name:$("#demand-name").val(),tel:$("#demand-phone").val(),email:$("#demand-email").val(),comment:$("#demand-comment").val(),skype:"",icq:"",site:"",lat:sn.geo.lat,lon:sn.geo.lon,city:sn.geo.city,region:sn.geo.region,country:sn.geo.country},dataType:"text",timeout:5e3})},addToGit:function(){var message,sn;return sn=$(this).data("sn"),message=""+$("#demand-name").val()+" "+$("#demand-phone").val()+" "+$("#demand-email").val()+" "+sn.geo.city+" "+$("#demand-comment").val()+" ",$.ajax({url:"http://git.st-n.ru/",type:"GET",data:{action:"addClaim",msg:message},dataType:"text",timeout:1e3,success:function(s){return alert(s)}})},check:function(){return $(this).snDemand("checkName",$("#demand-name").val())&&$(this).snDemand("checkPhone",$("#demand-phone").val())},checkName:function(val){var flag;return null==val&&(val=""),flag=$(this).snDemand("flagName",val),flag?($("#validate-name .validate-true").show(),$("#validate-name .validate-false").hide()):($("#validate-name .validate-true").hide(),$("#validate-name .validate-false").show()),flag},checkPhone:function(val){var flag;return null==val&&(val=""),flag=$(this).snDemand("flagPhone",val),flag?($("#validate-phone .validate-true").show(),$("#validate-phone .validate-false").hide()):($("#validate-phone .validate-true").hide(),$("#validate-phone .validate-false").show()),flag},flagName:function(name){var flag;return null==name&&(name=""),flag=!0,(""===name||"+7"===name)&&(flag=!1),(2>name.length||name.length>30)&&(flag=!1),/[^a-z0-9\.\,\"\?\!\;\:\#\$\%\&\(\)\*\+\-\/\<\>\=\@\[\]\\\^\_\{\}\|\~]+/i.test(name)||(flag=!1),flag},flagPhone:function(phone){var flag;return null==phone&&(phone=""),flag=!0,(""===phone||"+7"===phone)&&(flag=!1),(5>phone.length||phone.length>30)&&(flag=!1),/\+?\d{1,3}(?:\s*\(\d+\)\s*)?(?:(?:\-\d{1,3})+\d|[\d\-]{4,}|(?:\s\d{1,3})+\d)/i.test(phone)||(flag=!1),flag}},$.fn.snDemand=function(sn){return null==sn&&(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?$.error("Метод "+sn+" не существует"):methods.init.apply(this,arguments)}});